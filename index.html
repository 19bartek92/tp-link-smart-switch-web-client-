<!doctype html>
<html ng-app="myApp" ng-cloak>
<head>
    <meta charset="utf-8">
    <title>TP-Link Web UI</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/angular_material/1.1.0/angular-material.min.css">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
</head>
<body layout="column" style="overflow-y:hidden">
<div ng-controller="dash" style="overflow-y:auto" md-theme="custom">

    <md-toolbar>
        <div class="md-toolbar-tools">
            <h2 flex md-truncate>TP-Link Web UI</h2>
        </div>
    </md-toolbar>

    <md-tabs md-dynamic-height md-border-bottom md-selected="selected_tab_index">
        <md-tab label="Devices">
            <md-content ng-if="devices.length">
                <md-list class="md-dense" flex>
                    <md-subheader class="md-no-sticky">TP-Link Devices</md-subheader>
                    <md-list-item class="md-2-line" ng-repeat="device in devices">
                        <div class="md-list-item-text">
                            <h3>{{device.alias}}</h3>

                            <p>{{device.deviceModel}} - {{device.deviceName}}</p>
                        </div>
                        <md-switch ng-change="setState($index,device.is_powered)"
                                   ng-model="device.is_powered"></md-switch>
                        <md-divider/>
                    </md-list-item>
                </md-list>
                <md-button class="md-raised md-primary" ng-click="refreshDevices()">Refresh Devices</md-button>
            </md-content>
            <md-content ng-if="!devices.length" class="md-padding">
                <h3>Warning</h3>
                No devices were found. Please visit the 'Settings' tab to verify your credentials or request a new
                token.</h3>
            </md-content>

        </md-tab>

        <md-tab label="Settings">
            <md-content class="md-padding">
                <h3>TP-Link Authentication</h3>

                <p>
                    Please provide the credentials used to connect to your TP-Link account.
                </p>

                <div layout="column" layout-gt-xs="row">

                    <md-input-container flex="50">
                        <label>Username/Email</label>
                        <input required type="email" ng-model="username"
                               minlength="10" maxlength="100" ng-pattern="/^.+@.+\..+$/"/>

                        <div ng-messages="username.$error" role="alert">
                            <div ng-message-exp="['required', 'minlength', 'maxlength', 'pattern']">
                                Your email must be between 10 and 100 characters long and look like an e-mail address.
                            </div>
                        </div>
                    </md-input-container>
                    <md-input-container flex="50">
                        <label>Password</label>
                        <input required ng-model="password"/>

                        <div ng-messages="password.$error" role="alert">
                            <div ng-message-exp="['required']">
                                Password must be provided.
                            </div>
                        </div>
                    </md-input-container>
                </div>
                <div layout="column" layout-gt-xs="row">

                    <md-input-container flex="50">
                        <md-checkbox ng-model="store_credentials" aria-label="store credentials">
                            Allow this browser to store credentials.
                        </md-checkbox>
                    </md-input-container>
                    <md-input-container flex="50">
                        <md-checkbox ng-model="store_token" aria-label="store token">
                             Allow this browser to store the authentication token.
                        </md-checkbox>
                    </md-input-container>

                </div>

                <md-button class="md-button md-raised md-primary" ng-click="authenticate()">Authenticate and Refresh
                    Devices
                </md-button>

                <div ng-if="token != ''">
                    <br/>
                    <md-divider/>
                    <h3>Current Status</h3>

                    <p>Found {{devices.length}} devices using token: <code>{{token}}</code></p>
                </div>
            </md-content>

        </md-tab>

        <md-tab label="Notes">
            <md-content flex layout-padding>
                <p>Todo:</p>
                <ul>
                    <li><strike>generate UUID</strike> {{UUID}}</li>
                    <li><strike>authenticate against service</strike> {{token}}</li>
                    <li><strike>find device ids</strike></li>
                    <li><strike>make them actionable</strike></li>
                    <li><strike>store config so that it retrieves automatically</strike></li>
                    <li><strike>improve UI - tabs, probably</strike></li>
                    <li>clear the validation errors on keyup</li>
                    <li>add remember me</li>
                </ul>
            </md-content>
        </md-tab>

    </md-tabs>
</div>

<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.4/angular.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.4/angular-animate.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.4/angular-cookies.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.4/angular-aria.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.4/angular-messages.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/angular_material/1.1.4/angular-material.min.js"></script>

<script src="script.js"></script>
</body>
</html>

